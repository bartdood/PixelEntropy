<script>
  const viewer = new PhotoSphereViewer.Viewer({
    container: document.getElementById('viewer'),
    // FIXED: Changed 'scene/' to 'scenes/'
    panorama: 'scenes/bart-sf.jpg', 
    plugins: [
      [PhotoSphereViewer.MarkersPlugin, {}]
    ],
  });

  const markers = viewer.getPlugin(PhotoSphereViewer.MarkersPlugin);

function loadScene(sceneName) {
    markers.clearMarkers();

    viewer.setPanorama('scenes/' + sceneName).then(() => {
      
      // Marker Options (Red Circle)
      const markerStyle = {
        fill: 'rgba(255, 0, 0, 0.8)',
        stroke: 'white',
        strokeWidth: '2px',
      };

      // BART -> Ferry
      if (sceneName === 'bart-sf.jpg') {
        markers.addMarker({
          id: 'to-ferry',
          // REPLACE IMAGE WITH CIRCLE
          circle: 20,
          circleStyle: markerStyle,
          // Position
          yaw: 1.0, 
          pitch: -0.1,
          tooltip: 'Go to Ferry',
          data: { target: 'ferry-sf.jpg' }
        });
      }

      // Ferry -> Bay Bridge
      if (sceneName === 'ferry-sf.jpg') {
        markers.addMarker({
          id: 'to-bridge',
          circle: 20,
          circleStyle: markerStyle,
          yaw: -2.2,
          pitch: -0.1,
          tooltip: 'Go to Bay Bridge',
          data: { target: 'bay-bridge-sf.jpg' }
        });
      }

      // Bay Bridge -> BART
      if (sceneName === 'bay-bridge-sf.jpg') {
        markers.addMarker({
          id: 'to-bart',
          circle: 20,
          circleStyle: markerStyle,
          yaw: 2.8,
          pitch: -0.1,
          tooltip: 'Back to BART',
          data: { target: 'bart-sf.jpg' }
        });
      }
    });
  }

  markers.on('select-marker', (e, marker) => {
    if (marker.data && marker.data.target) {
      loadScene(marker.data.target);
    }
  });

  // Start the tour
  loadScene('bart-sf.jpg');
</script>
