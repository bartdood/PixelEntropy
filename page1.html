<script>
  const viewer = new PhotoSphereViewer.Viewer({
    container: document.getElementById('viewer'),
    // FIXED: Changed 'scene/' to 'scenes/'
    panorama: 'scenes/bart-sf.jpg', 
    plugins: [
      [PhotoSphereViewer.MarkersPlugin, {}]
    ],
  });

  const markers = viewer.getPlugin(PhotoSphereViewer.MarkersPlugin);

  function loadScene(sceneName) {
    markers.clearMarkers();

    // FIXED: Changed 'scene/' to 'scenes/'
    viewer.setPanorama('scenes/' + sceneName).then(() => {

      // BART -> Ferry
      if (sceneName === 'bart-sf.jpg') {
        markers.addMarker({
          id: 'to-ferry',
          image: 'https://cdn-icons-png.flaticon.com/512/709/709586.png',
          width: 32,
          height: 32,
          tooltip: 'Go to Ferry',
          data: { target: 'ferry-sf.jpg' }
        });
      }

      // Ferry -> Bay Bridge
      if (sceneName === 'ferry-sf.jpg') {
        markers.addMarker({
          id: 'to-bridge',
          image: 'https://cdn-icons-png.flaticon.com/512/709/709586.png',
          width: 32,
          height: 32,
          tooltip: 'Go to Bay Bridge',
          data: { target: 'bay-bridge-sf.jpg' }
        });
      }

      // Bay Bridge -> BART
      if (sceneName === 'bay-bridge-sf.jpg') {
        markers.addMarker({
          id: 'to-bart',
          image: 'https://cdn-icons-png.flaticon.com/512/709/709586.png',
          width: 32,
          height: 32,
          tooltip: 'Back to BART',
          data: { target: 'bart-sf.jpg' }
        });
      }
    });
  }

  markers.on('select-marker', (e, marker) => {
    if (marker.data && marker.data.target) {
      loadScene(marker.data.target);
    }
  });

  // Start the tour
  loadScene('bart-sf.jpg');
</script>
