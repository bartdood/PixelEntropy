<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SF Virtual Tour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/markers-plugin/index.min.css" />

  <style>
    body { margin: 0; background: #000; font-family: sans-serif; }
    #viewer { width: 100vw; height: 100vh; }
  </style>
</head>
<body>

<div id="viewer"></div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three/build/three.module.js",
    "@photo-sphere-viewer/core": "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.module.js",
    "@photo-sphere-viewer/markers-plugin": "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/markers-plugin/index.module.js"
  }
}
</script>

<script type="module">
  import { Viewer } from '@photo-sphere-viewer/core';
  import { MarkersPlugin } from '@photo-sphere-viewer/markers-plugin';

  const viewer = new Viewer({
    container: document.querySelector('#viewer'),
    panorama: 'scenes/bart-sf.jpg', 
    plugins: [
      [MarkersPlugin, {}]
    ],
  });

  const markers = viewer.getPlugin(MarkersPlugin);

  // =========================================================
  //  HUGE MARKER STYLE
  // =========================================================
  function createLabel(text) {
    // CHANGE SIZE HERE LATER
    // To make small: change font-size to '20px' and padding to '10px'
    return `
      <div style="
        cursor: pointer;
        color: black; 
        font-weight: bold; 
        font-size: 80px;        /* HUGE TEXT */
        background: #00ff00;    /* BRIGHT GREEN */
        padding: 40px;          /* HUGE PADDING */
        border: 10px solid white; 
        border-radius: 20px;
      ">
        ${text}
      </div>
    `;
  }

  function getMarkersForScene(sceneName) {
    const newMarkers = [];

    // Scene 1: BART
    if (sceneName === 'bart-sf.jpg') {
      newMarkers.push({
        id: 'to-ferry',
        content: createLabel('➡ Go to Ferry'),
        yaw: 0.5, pitch: -0.1,
        data: { target: 'ferry-sf.jpg' }
      });
    }

    // Scene 2: Ferry
    if (sceneName === 'ferry-sf.jpg') {
      newMarkers.push({
        id: 'to-bridge',
        content: createLabel('➡ Go to Bridge'),
        yaw: -0.5, pitch: 0,
        data: { target: 'bay-bridge-sf.jpg' }
      });
    }

    // Scene 3: Bridge
    if (sceneName === 'bay-bridge-sf.jpg') {
      newMarkers.push({
        id: 'to-bart',
        content: createLabel('⬅ Back to BART'),
        yaw: 2.8, pitch: 0,
        data: { target: 'bart-sf.jpg' }
      });
    }
    return newMarkers;
  }

  // --- Logic to Switch Scenes --- //

  viewer.addEventListener('ready', () => {
    const startScene = 'bart-sf.jpg';
    const startMarkers = getMarkersForScene(startScene);
    startMarkers.forEach(m => markers.addMarker(m));
  }, { once: true });

  markers.addEventListener('select-marker', ({ marker }) => {
    if (marker.data && marker.data.target) {
      const nextScene = marker.data.target;
      
      viewer.setPanorama('scenes/' + nextScene).then(() => {
        markers.clearMarkers();
        const nextMarkers = getMarkersForScene(nextScene);
        nextMarkers.forEach(m => markers.addMarker(m));
      }).catch(err => {
        console.error(err);
        alert("Error loading: scenes/" + nextScene);
      });
    }
  });

</script>
</body>
</html>
